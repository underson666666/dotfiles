# Todo Sort by Project

TodoリストをプロジェクトごとにSortするVimScriptです。メインタスクとサブタスクの階層構造を保持したまま、プロジェクト名や期限でタスクを整理できます。

## 機能

このプラグインは3つの主要なソート機能を提供します：

- **プロジェクト + 期限ソート**: プロジェクトごとにグループ化し、同一プロジェクト内では期限順にソート
- **プロジェクトのみソート**: プロジェクトごとにのみグループ化（期限は無視）
- **タスクブロック構造保持**: メインタスクとそのサブタスクを1つのブロックとして扱い、構造を維持

## インストール

`sort_todo_by_project.vim`を以下のいずれかの場所に配置してください：

- `~/.vim/plugin/` (Unix/Linux/macOS)
- `~/vimfiles/plugin/` (Windows)

または、お好みのプラグインマネージャーを使用してください。

## 使用方法

### キーマップ

デフォルトで以下のキーマップが設定されています：

**プロジェクト + 期限ソート:**
- `<leader>spd` - ビジュアル選択範囲をソート
- `<leader>spda` - ファイル全体をソート

**プロジェクトのみソート:**
- `<leader>sp` - ビジュアル選択範囲をソート
- `<leader>spa` - ファイル全体をソート

### 手動実行

コマンドラインから直接関数を呼び出すことも可能です：

```vim
" 選択範囲をプロジェクト+期限でソート
:'<,'>call SortTodoByProjectAndDue()

" ファイル全体をプロジェクトのみでソート
:%call SortTodoByProjectOnly()
```

## Todo形式の要件

このプラグインは以下の形式のTodoリストを想定しています：

### プロジェクト名

プロジェクト名は `+プロジェクト名` 形式で記述します：

```
- [ ] タスク1 +work
- [ ] タスク2 +personal
```

### 期限

期限は `due:YYYY-MM-DD` 形式で記述します：

```
- [ ] レポート作成 +work due:2024-12-31
- [ ] 年賀状準備 +personal due:2024-12-20
```

### タスク階層

インデントを使ってサブタスクを表現できます：

```
- [ ] プロジェクト企画 +work due:2024-12-25
    - [ ] 資料作成
    - [ ] チームミーティング
    - [ ] 予算見積もり
- [ ] 買い物 +personal
    - [ ] 牛乳
    - [ ] パン
```

## ソート動作

### プロジェクト優先度

1. プロジェクト名でアルファベット順にソート
2. プロジェクト名が指定されていないタスクは最後に配置

### 期限優先度（プロジェクト+期限ソートの場合）

同一プロジェクト内では：
1. 期限が早いタスクを優先
2. 期限が指定されていないタスクは最後に配置

### タスクブロック保持

メインタスクとそのサブタスクは1つのブロックとして扱われ、ソート時にも構造が維持されます。

## 使用例

### ソート前

```
- [ ] 年末パーティー準備 +personal due:2024-12-30
    - [ ] 会場予約
    - [ ] 料理準備
- [ ] 四半期レポート +work due:2024-12-28
    - [ ] データ集計
    - [ ] グラフ作成
- [ ] お歳暮手配 +personal due:2024-12-20
- [ ] 来期企画書 +work due:2025-01-15
```

### ソート後（プロジェクト+期限）

```
- [ ] 四半期レポート +work due:2024-12-28
    - [ ] データ集計
    - [ ] グラフ作成
- [ ] 来期企画書 +work due:2025-01-15
- [ ] お歳暮手配 +personal due:2024-12-20
- [ ] 年末パーティー準備 +personal due:2024-12-30
    - [ ] 会場予約
    - [ ] 料理準備
```

## デバッグ機能

タスクの期限とプロジェクト情報を確認したい場合は、以下の関数を使用できます：

```vim
:'<,'>call ShowTaskDueDates()
```

## カスタマイズ

### キーマップの変更

デフォルトのキーマップを変更したい場合は、`.vimrc`に以下のような設定を追加してください：

```vim
" カスタムキーマップの例
vnoremap <leader>ts :call SortTodoByProjectAndDue()<CR>
nnoremap <leader>tsa :%call SortTodoByProjectAndDue()<CR>
```

### 期限形式の変更

期限の形式を変更したい場合は、`ExtractDueDate`関数を修正してください。

## 注意事項

- 空行やMarkdownの見出し（`#`で始まる行）は自動的にスキップされます
- インデントはスペースまたはタブに対応していますが、一貫性を保つことを推奨します
- プロジェクト名は英数字のみサポートしています

## ライセンス

このプラグインはオープンソースとして提供されています。自由にご利用ください。
